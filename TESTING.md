# 🧪 测试指南

快速运行测试程序以验证埋点 SDK 的功能。

## 快速开始

### 1. 安装依赖并构建

```bash
# 安装依赖
yarn install

# 构建 SDK
yarn build
```

### 2. 运行测试程序

#### 快速测试 (推荐首次使用) ⚡

```bash
yarn example:quick
```

**预计运行时间**: ~10 秒  
**测试内容**: 9 个基本功能步骤

#### 基础示例

```bash
yarn example:basic
```

**用途**: 查看代码示例和基本用法

#### 综合测试 (完整功能验证) 🧪

```bash
yarn example:test
```

**预计运行时间**: ~60 秒  
**测试内容**: 13 个完整测试场景（包括性能测试）

## 测试程序说明

| 命令 | 文件 | 用途 | 测试场景 | 运行时间 |
|------|------|------|---------|---------|
| `yarn example:quick` | `quick-test.ts` | 快速验证基本功能 | 9 个步骤 | ~10s |
| `yarn example:basic` | `basic-usage.ts` | 学习代码示例 | 示例代码 | N/A |
| `yarn example:test` | `comprehensive-test.ts` | 全面功能测试 | 13 个场景 | ~60s |

## 测试输出示例

### 快速测试输出

```
🚀 开始快速测试...

📦 步骤 1: 初始化 SDK
[TrackingSDK] TrackingSDK 已创建 {...}
[TrackingSDK] SDK 初始化完成
✅ SDK 初始化成功

📝 步骤 2: 用户注册
[TrackingSDK] 用户 ID 已设置: user_1701234567890
[TrackingSDK] 事件已追踪: {...}
✅ 用户注册: user_1701234567890

🔍 步骤 3: 页面访问
[TrackingSDK] 事件已追踪: {...}
✅ 页面访问追踪完成

... (更多输出)

🎉 快速测试完成！
```

### 综合测试输出

```
╔═══════════════════════════════════════════════════════════╗
║                                                           ║
║         🧪 埋点 SDK 综合测试程序                          ║
║                                                           ║
╚═══════════════════════════════════════════════════════════╝

============================================================
🧪 测试 1: SDK 初始化
============================================================
✅ SDK 初始化成功
ℹ️  配置: {
  "apiEndpoint": "https://api-test.holink.com",
  "siteDomain": "test.holink.com",
  "debug": true,
  "batchSize": 5,
  "batchInterval": 3000
}

============================================================
🧪 测试 2: 用户注册流程
============================================================
✅ 设置用户 ID: test_user_1701234567890
✅ 注册事件已追踪

... (13 个测试场景)

============================================================
🧪 测试 12: 性能测试
============================================================
ℹ️  开始生成 100 个事件...
ℹ️  已生成 20/100 个事件
ℹ️  已生成 40/100 个事件
ℹ️  已生成 60/100 个事件
ℹ️  已生成 80/100 个事件
ℹ️  已生成 100/100 个事件
✅ 性能测试完成
ℹ️  总事件数: 100
ℹ️  总耗时: 245ms
ℹ️  平均每个事件: 2.45ms

╔═══════════════════════════════════════════════════════════╗
║                                                           ║
║         ✅ 所有测试完成                                    ║
║                                                           ║
╚═══════════════════════════════════════════════════════════╝
```

## 测试场景详情

### 综合测试包含的场景

1. ✅ **SDK 初始化** - 测试配置和初始化
2. ✅ **用户注册** - 测试注册事件追踪
3. ✅ **登录登出** - 测试用户认证流程
4. ✅ **订阅功能** - 测试多种订阅计划
5. ✅ **页面访问** - 测试页面浏览追踪
6. ✅ **点击事件** - 测试多种点击场景
7. ✅ **自定义事件** - 测试业务自定义事件
8. ✅ **批量上报** - 验证批量发送机制
9. ✅ **即时上报** - 测试重要事件即时发送
10. ✅ **手动刷新** - 测试手动触发队列刷新
11. ✅ **用户完整旅程** - 模拟真实用户行为链路
12. ✅ **性能测试** - 测试 100 个事件的处理性能
13. ✅ **错误处理** - 测试边界情况和异常处理

## 常见问题

### Q: 看不到调试日志？
**A**: 检查测试配置中的 `debug: true` 是否设置

### Q: 事件没有立即发送？
**A**: 这是正常的批量上报机制，事件会在以下情况发送：
- 达到批量阈值 (默认 5 个)
- 达到时间间隔 (默认 3 秒)
- 手动调用 `flush()`
- 页面关闭时

### Q: API 请求失败？
**A**: 测试程序使用模拟 API 端点，实际请求可能失败。这不影响测试 SDK 的功能逻辑。如需真实测试，请修改配置中的 `apiEndpoint`。

### Q: 如何自定义测试？
**A**: 编辑测试文件中的 `TEST_CONFIG` 配置：

```typescript
const TEST_CONFIG = {
  apiEndpoint: 'https://your-api.com',
  siteDomain: 'your-site.com',
  debug: true,
  batchSize: 5,
  batchInterval: 3000,
}
```

## 性能基准

基于综合测试程序的性能指标：

| 指标 | 预期值 |
|------|--------|
| 单个事件处理时间 | < 5ms |
| 100 个事件处理时间 | < 500ms |
| 批量上报延迟 | < 100ms |

## 更多信息

- 📖 [示例程序详细文档](examples/README.md)
- 📖 [测试指南详细说明](examples/TEST_GUIDE.md)
- 📖 [主文档](README.md)
- 📖 [API 文档](README.md#-api-文档)

## 开发建议

### 开发阶段
1. 使用 `debug: true` 查看详细日志
2. 使用快速测试快速验证功能
3. 根据需求调整批量参数

### 测试阶段
1. 运行综合测试验证所有功能
2. 检查性能指标
3. 测试边界情况

### 生产部署前
1. 设置 `debug: false`
2. 优化批量参数
3. 启用本地存储 `enableStorage: true`
4. 进行最终测试

## 贡献

欢迎提交新的测试场景！查看 [examples/](examples/) 目录了解更多。

