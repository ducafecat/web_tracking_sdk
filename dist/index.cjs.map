{"version":3,"sources":["../src/index.ts","../src/types.ts","../src/EventQueue.ts","../src/StorageManager.ts","../src/sdk.ts"],"sourcesContent":["/**\n * Holink Tracking SDK\n * 用户行为埋点 SDK - 用于追踪用户的注册、订阅、登录等关键行为\n */\n\n// 主 SDK 类\nexport { TrackingSDK } from './sdk'\n\n// 事件队列管理器\nexport { EventQueue } from './EventQueue'\n\n// 本地存储管理器\nexport { StorageManager } from './StorageManager'\n\n// 枚举类型 - 必须单独导出，因为枚举在运行时存在\nexport { EventType } from './types'\n\n// 导出所有接口类型 - 使用 export type 确保这些只在编译时使用\nexport type {\n  TrackingConfig,\n  TrackingEventPayload,\n  TrackingResponse,\n  BaseEvent,\n  RegisterEvent,\n  SubscribeEvent,\n  LoginEvent,\n  VisitEvent,\n  ClickEvent,\n} from './types'\n","/**\n * 埋点 SDK 类型定义\n * 注意：字段命名与后端 MongoDB Schema 保持一致\n */\n\n/** 事件类型枚举 */\nexport enum EventType {\n  /** 用户注册 */\n  REGISTER = 'register',\n  /** 用户订阅 */\n  SUBSCRIBE = 'subscribe',\n  /** 用户登录 */\n  LOGIN = 'login',\n  /** 用户登出 */\n  LOGOUT = 'logout',\n  /** 页面访问 */\n  VISIT = 'visit',\n  /** 点击事件 */\n  CLICK = 'click',\n  /** 自定义事件 */\n  CUSTOM = 'custom',\n}\n\n/**\n * 发送给后端的事件数据格式（扁平化结构，用于 URL 参数）\n * 注意：必须与后端 UserEventMongo 接口匹配\n */\nexport interface TrackingEventPayload {\n  /** 事件类型 */\n  eventType: string\n\n  /** 站点域名（用于多站点统计，例如：holink.com, holink.me） */\n  siteDomain?: string\n\n  /** 用户 UID（业务系统的用户 ID）- 注意字段名是 x_uid */\n  x_uid?: string\n\n  /** 链接 ID（可选，用于关联具体业务）- 注意字段名是 x_link_id */\n  x_link_id?: string\n\n  /** 事件时间戳（Unix 时间戳，精确到毫秒） */\n  timestamp: number\n\n  /** 请求 URI（页面路径 + 查询参数） */\n  uri: string\n\n  /** 请求来源（Referer）- 注意是单个 r */\n  referer?: string\n\n  /** 原始 User-Agent 字符串 */\n  userAgent: string\n\n  /** 会话 ID */\n  sessionId: string\n\n  // ========== 扁平化的事件特定字段 ==========\n  \n  /** 注册来源（register 事件） */\n  source?: string\n\n  /** 订阅计划（subscribe 事件） */\n  plan?: string\n\n  /** 订阅时长/月（subscribe 事件） */\n  duration?: number\n\n  /** 订阅金额（subscribe 事件） */\n  amount?: number\n\n  /** 登录方式（login 事件） */\n  loginMethod?: string\n\n  /** 页面路径（visit 事件） */\n  path?: string\n\n  /** 页面标题（visit 事件） */\n  title?: string\n\n  /** 元素 ID（click 事件） */\n  elementId?: string\n\n  /** 元素文本（click 事件） */\n  elementText?: string\n\n  /** 页面 URL（客户端信息） */\n  url?: string\n\n  /** 屏幕分辨率（客户端信息） */\n  screenResolution?: string\n\n  /** 视口大小（客户端信息） */\n  viewport?: string\n\n  /** 浏览器语言（客户端信息） */\n  language?: string\n\n  /** 时区（客户端信息） */\n  timezone?: string\n\n  /** 平台（客户端信息） */\n  platform?: string\n\n  // 自定义事件的额外字段（可以动态添加）\n  [key: string]: any\n}\n\n/**\n * 基础事件接口（用于业务代码调用）\n */\nexport interface BaseEvent {\n  /** 事件类型 */\n  eventType: EventType | string\n\n  /** 用户 UID（业务系统的用户 ID） */\n  uid?: string\n\n  /** 链接 ID（业务标识） */\n  linkId?: string\n\n  /** 事件附加数据 */\n  eventData?: Record<string, any>\n}\n\n/** 注册事件 */\nexport interface RegisterEvent extends BaseEvent {\n  eventType: EventType.REGISTER\n  /** 注册来源 */\n  source?: string\n}\n\n/** 订阅事件 */\nexport interface SubscribeEvent extends BaseEvent {\n  eventType: EventType.SUBSCRIBE\n  /** 订阅计划 */\n  plan?: string\n  /** 订阅时长（月） */\n  duration?: number\n  /** 订阅金额 */\n  amount?: number\n}\n\n/** 登录事件 */\nexport interface LoginEvent extends BaseEvent {\n  eventType: EventType.LOGIN\n  /** 登录方式 */\n  loginMethod?: 'email' | 'phone' | 'social' | 'sso'\n}\n\n/** 页面访问事件 */\nexport interface VisitEvent extends BaseEvent {\n  eventType: EventType.VISIT\n  /** 页面路径 */\n  path?: string\n  /** 页面标题 */\n  title?: string\n}\n\n/** 点击事件 */\nexport interface ClickEvent extends BaseEvent {\n  eventType: EventType.CLICK\n  /** 元素 ID */\n  elementId?: string\n  /** 元素文本 */\n  elementText?: string\n}\n\n/** SDK 配置 */\nexport interface TrackingConfig {\n  /** API 端点（例如：https://your-api.com） */\n  apiEndpoint: string\n\n  /** 站点域名（用于多站点统计，例如：'holink.com'）\n   * 如果不设置，SDK 会自动使用 window.location.hostname */\n  siteDomain?: string\n\n  /** 是否启用调试模式 */\n  debug?: boolean\n\n  /** 批量上报的事件数量阈值（默认：10） */\n  batchSize?: number\n\n  /** 批量上报的时间间隔（毫秒，默认：5000） */\n  batchInterval?: number\n\n  /** 是否自动采集页面访问事件（默认：true） */\n  autoPageView?: boolean\n\n  /** 是否自动采集点击事件（默认：false） */\n  autoClick?: boolean\n\n  /** 请求超时时间（毫秒，默认：10000） */\n  timeout?: number\n\n  /** 最大重试次数（默认：3） */\n  maxRetries?: number\n\n  /** 是否启用本地存储（默认：true） */\n  enableStorage?: boolean\n\n  /** 存储 key 前缀（默认：holink_track_） */\n  storagePrefix?: string\n}\n\n/** 事件上报响应 */\nexport interface TrackingResponse {\n  success: boolean\n  message?: string\n  code?: number\n}\n","/**\n * 事件队列管理器\n * 负责批量上报和队列管理\n */\n\nimport type { TrackingEventPayload } from './types'\n\ninterface EventQueueConfig {\n  batchSize: number\n  batchInterval: number\n  onFlush: (events: TrackingEventPayload[]) => Promise<void>\n}\n\nexport class EventQueue {\n  private queue: TrackingEventPayload[] = []\n  private config: EventQueueConfig\n  private flushTimer: ReturnType<typeof setTimeout> | null = null\n\n  constructor(config: EventQueueConfig) {\n    this.config = config\n    this.startFlushTimer()\n  }\n\n  /**\n   * 添加事件到队列\n   */\n  public push(event: TrackingEventPayload): void {\n    this.queue.push(event)\n\n    // 如果达到批量阈值，立即刷新\n    if (this.queue.length >= this.config.batchSize) {\n      this.flush()\n    }\n  }\n\n  /**\n   * 刷新队列（发送所有事件）\n   */\n  public flush(): void {\n    if (this.queue.length === 0) return\n\n    const eventsToSend = [...this.queue]\n    this.queue = []\n\n    // 重置定时器\n    this.resetFlushTimer()\n\n    // 调用回调函数发送事件\n    this.config.onFlush(eventsToSend).catch((error) => {\n      console.error('[EventQueue] 刷新失败:', error)\n      // 发送失败，重新加入队列\n      this.queue.unshift(...eventsToSend)\n    })\n  }\n\n  /**\n   * 获取所有队列中的事件\n   */\n  public getAll(): TrackingEventPayload[] {\n    return [...this.queue]\n  }\n\n  /**\n   * 清空队列\n   */\n  public clear(): void {\n    this.queue = []\n  }\n\n  /**\n   * 销毁队列\n   */\n  public destroy(): void {\n    this.flush()\n    this.stopFlushTimer()\n  }\n\n  /**\n   * 启动定时刷新\n   */\n  private startFlushTimer(): void {\n    this.flushTimer = setInterval(() => {\n      this.flush()\n    }, this.config.batchInterval)\n  }\n\n  /**\n   * 重置定时器\n   */\n  private resetFlushTimer(): void {\n    this.stopFlushTimer()\n    this.startFlushTimer()\n  }\n\n  /**\n   * 停止定时器\n   */\n  private stopFlushTimer(): void {\n    if (this.flushTimer) {\n      clearInterval(this.flushTimer)\n      this.flushTimer = null\n    }\n  }\n}\n","/**\n * 本地存储管理器\n * 用于持久化用户 ID 和待发送事件\n */\n\nimport type { TrackingEventPayload } from './types'\n\nexport class StorageManager {\n  private prefix: string\n\n  constructor(prefix: string = 'holink_track_') {\n    this.prefix = prefix\n  }\n\n  /**\n   * 保存用户 ID\n   */\n  public setUserId(userId: string): void {\n    this.setItem('user_id', userId)\n  }\n\n  /**\n   * 获取用户 ID\n   */\n  public getUserId(): string | null {\n    return this.getItem('user_id')\n  }\n\n  /**\n   * 清除用户 ID\n   */\n  public clearUserId(): void {\n    this.removeItem('user_id')\n  }\n\n  /**\n   * 保存待发送事件\n   */\n  public savePendingEvents(events: TrackingEventPayload[]): void {\n    this.setItem('pending_events', JSON.stringify(events))\n  }\n\n  /**\n   * 获取待发送事件\n   */\n  public getPendingEvents(): TrackingEventPayload[] {\n    const data = this.getItem('pending_events')\n    if (!data) return []\n\n    try {\n      return JSON.parse(data)\n    } catch {\n      return []\n    }\n  }\n\n  /**\n   * 清除待发送事件\n   */\n  public clearPendingEvents(): void {\n    this.removeItem('pending_events')\n  }\n\n  // ========== 底层存储方法 ==========\n\n  private setItem(key: string, value: string): void {\n    try {\n      localStorage.setItem(this.prefix + key, value)\n    } catch (error) {\n      console.error('[StorageManager] 存储失败:', error)\n    }\n  }\n\n  private getItem(key: string): string | null {\n    try {\n      return localStorage.getItem(this.prefix + key)\n    } catch (error) {\n      console.error('[StorageManager] 读取失败:', error)\n      return null\n    }\n  }\n\n  private removeItem(key: string): void {\n    try {\n      localStorage.removeItem(this.prefix + key)\n    } catch (error) {\n      console.error('[StorageManager] 删除失败:', error)\n    }\n  }\n}\n","/**\n * 用户行为埋点 SDK\n * 用于追踪用户的注册、订阅、登录等关键行为\n *\n * 核心特点：\n * 1. 数据格式与后端 API 完全匹配（扁平化结构）\n * 2. 客户端只采集基础信息，服务端负责扩展字段\n * 3. 支持批量上报、离线重试、本地存储\n */\n\nimport { EventType } from './types'\nimport type {\n  BaseEvent,\n  RegisterEvent,\n  SubscribeEvent,\n  LoginEvent,\n  ClickEvent,\n  TrackingConfig,\n  TrackingResponse,\n  TrackingEventPayload,\n} from './types'\nimport { EventQueue } from './EventQueue'\nimport { StorageManager } from './StorageManager'\n\nexport class TrackingSDK {\n  private config: Required<TrackingConfig>\n  private eventQueue: EventQueue\n  private storage: StorageManager\n  private currentUserId: string | null = null\n  private sessionId: string\n  private isInitialized: boolean = false\n\n  constructor(config: TrackingConfig) {\n    // 合并默认配置\n    this.config = {\n      apiEndpoint: config.apiEndpoint,\n      siteDomain:\n        config.siteDomain || (typeof window !== 'undefined' ? window.location.hostname : ''),\n      debug: config.debug ?? false,\n      batchSize: config.batchSize ?? 10,\n      batchInterval: config.batchInterval ?? 5000,\n      autoPageView: config.autoPageView ?? true,\n      autoClick: config.autoClick ?? false,\n      timeout: config.timeout ?? 10000,\n      maxRetries: config.maxRetries ?? 3,\n      enableStorage: config.enableStorage ?? true,\n      storagePrefix: config.storagePrefix ?? 'holink_track_',\n    }\n\n    // 初始化各个模块\n    this.storage = new StorageManager(this.config.storagePrefix)\n    this.eventQueue = new EventQueue({\n      batchSize: this.config.batchSize,\n      batchInterval: this.config.batchInterval,\n      onFlush: this.sendBatch.bind(this),\n    })\n\n    // 生成会话 ID\n    this.sessionId = this.generateSessionId()\n\n    this.log('TrackingSDK 已创建', this.config)\n  }\n\n  /**\n   * 初始化 SDK\n   */\n  public async init(): Promise<void> {\n    if (this.isInitialized) {\n      this.log('SDK 已初始化')\n      return\n    }\n\n    // 恢复用户 ID 和未发送的事件\n    if (this.config.enableStorage) {\n      this.currentUserId = this.storage.getUserId()\n\n      const pendingEvents = this.storage.getPendingEvents()\n      if (pendingEvents.length > 0) {\n        this.log(`恢复 ${pendingEvents.length} 个待发送事件`)\n        pendingEvents.forEach((event) => this.eventQueue.push(event))\n      }\n    }\n\n    // 自动采集页面访问\n    if (this.config.autoPageView) {\n      this.trackVisit()\n      this.setupPageViewListener()\n    }\n\n    // 自动采集点击事件\n    if (this.config.autoClick) {\n      this.setupClickListener()\n    }\n\n    // 监听页面关闭事件\n    this.setupBeforeUnloadListener()\n\n    this.isInitialized = true\n    this.log('SDK 初始化完成')\n  }\n\n  /**\n   * 设置用户 ID\n   */\n  public setUserId(userId: string): void {\n    this.currentUserId = userId\n    if (this.config.enableStorage) {\n      this.storage.setUserId(userId)\n    }\n    this.log('用户 ID 已设置:', userId)\n  }\n\n  /**\n   * 清除用户 ID（登出时调用）\n   */\n  public clearUserId(): void {\n    this.currentUserId = null\n    if (this.config.enableStorage) {\n      this.storage.clearUserId()\n    }\n    this.log('用户 ID 已清除')\n  }\n\n  /**\n   * 追踪注册事件\n   */\n  public trackRegister(data: Partial<RegisterEvent> = {}): void {\n    const event: BaseEvent = {\n      eventType: EventType.REGISTER,\n      uid: data.uid || this.currentUserId || undefined,\n      linkId: data.linkId || 'register',\n      eventData: {\n        source: data.source,\n        ...data.eventData,\n      },\n    }\n\n    this.track(event)\n  }\n\n  /**\n   * 追踪订阅事件\n   */\n  public trackSubscribe(data: Partial<SubscribeEvent>): void {\n    const event: BaseEvent = {\n      eventType: EventType.SUBSCRIBE,\n      uid: data.uid || this.currentUserId || undefined,\n      linkId: data.linkId || 'subscribe',\n      eventData: {\n        plan: data.plan,\n        duration: data.duration,\n        amount: data.amount,\n        ...data.eventData,\n      },\n    }\n\n    this.track(event)\n  }\n\n  /**\n   * 追踪登录事件\n   */\n  public trackLogin(data: Partial<LoginEvent> = {}): void {\n    const event: BaseEvent = {\n      eventType: EventType.LOGIN,\n      uid: data.uid || this.currentUserId || undefined,\n      linkId: data.linkId || 'login',\n      eventData: {\n        loginMethod: data.loginMethod,\n        ...data.eventData,\n      },\n    }\n\n    this.track(event)\n  }\n\n  /**\n   * 追踪登出事件\n   */\n  public trackLogout(): void {\n    const event: BaseEvent = {\n      eventType: EventType.LOGOUT,\n      uid: this.currentUserId || undefined,\n      linkId: 'logout',\n    }\n\n    this.track(event)\n    this.clearUserId()\n  }\n\n  /**\n   * 追踪页面访问事件\n   */\n  public trackVisit(path?: string, title?: string): void {\n    const event: BaseEvent = {\n      eventType: EventType.VISIT,\n      uid: this.currentUserId || undefined,\n      linkId: 'page_view',\n      eventData: {\n        path: path || (typeof window !== 'undefined' ? window.location.pathname : ''),\n        title: title || (typeof document !== 'undefined' ? document.title : ''),\n      },\n    }\n\n    this.track(event)\n  }\n\n  /**\n   * 追踪页面访问事件（trackVisit 的别名，兼容 Nuxt 集成）\n   */\n  public trackPageView(path?: string, title?: string): void {\n    this.trackVisit(path, title)\n  }\n\n  /**\n   * 追踪点击事件\n   */\n  public trackClick(data: Partial<ClickEvent> | string): void {\n    let event: BaseEvent\n\n    if (typeof data === 'string') {\n      // 简单用法：只传递元素 ID\n      event = {\n        eventType: EventType.CLICK,\n        uid: this.currentUserId || undefined,\n        linkId: 'click_event',\n        eventData: {\n          elementId: data,\n        },\n      }\n    } else {\n      // 完整用法：传递对象\n      event = {\n        eventType: EventType.CLICK,\n        uid: data.uid || this.currentUserId || undefined,\n        linkId: data.linkId || 'click_event',\n        eventData: {\n          elementId: data.elementId,\n          elementText: data.elementText,\n          ...data.eventData,\n        },\n      }\n    }\n\n    this.track(event)\n  }\n\n  /**\n   * 追踪自定义事件\n   */\n  public trackCustom(eventName: string, data: Record<string, any> = {}): void {\n    const event: BaseEvent = {\n      eventType: eventName,\n      uid: this.currentUserId || undefined,\n      linkId: data.linkId || 'custom',\n      eventData: data,\n    }\n\n    this.track(event)\n  }\n\n  /**\n   * 通用追踪方法（核心方法）\n   */\n  private track(event: BaseEvent): void {\n    // 转换为后端 API 格式（扁平化结构）\n    const payload = this.transformToPayload(event)\n\n    // 添加到队列\n    this.eventQueue.push(payload)\n\n    // 保存到本地存储（用于离线重试）\n    if (this.config.enableStorage) {\n      this.storage.savePendingEvents(this.eventQueue.getAll())\n    }\n\n    this.log('事件已追踪:', payload)\n  }\n\n  /**\n   * 转换为后端 API 格式（扁平化结构）\n   * 关键方法：将业务事件转换为后端期望的扁平化数据结构，用于 URL 参数\n   */\n  private transformToPayload(event: BaseEvent): TrackingEventPayload {\n    const isWindowAvailable = typeof window !== 'undefined'\n    const isDocumentAvailable = typeof document !== 'undefined'\n    const isNavigatorAvailable = typeof navigator !== 'undefined'\n\n    const payload: TrackingEventPayload = {\n      // 基础字段\n      eventType: event.eventType,\n      siteDomain: this.config.siteDomain,\n      x_uid: event.uid,\n      x_link_id: event.linkId,\n      timestamp: Date.now(),\n      uri: isWindowAvailable ? window.location.pathname + window.location.search : '',\n      referer: isDocumentAvailable ? document.referrer || undefined : undefined,\n      userAgent: isNavigatorAvailable ? navigator.userAgent : '',\n      sessionId: this.sessionId,\n    }\n\n    // 扁平化客户端信息\n    if (isWindowAvailable && isNavigatorAvailable) {\n      payload.url = window.location.href\n      payload.screenResolution = `${window.screen.width}x${window.screen.height}`\n      payload.viewport = `${window.innerWidth}x${window.innerHeight}`\n      payload.language = navigator.language\n      payload.timezone = Intl.DateTimeFormat().resolvedOptions().timeZone\n      payload.platform = navigator.platform\n    }\n\n    // 扁平化事件特定数据（将 eventData 中的字段展开到顶层）\n    if (event.eventData) {\n      Object.assign(payload, event.eventData)\n    }\n\n    return payload\n  }\n\n  /**\n   * 批量发送事件（使用 GET + URL 参数，逐个发送）\n   */\n  private async sendBatch(events: TrackingEventPayload[]): Promise<void> {\n    if (events.length === 0) return\n\n    const endpoint = `${this.config.apiEndpoint}/api/track/event`\n    let successCount = 0\n    const failedEvents: TrackingEventPayload[] = []\n\n    try {\n      // 逐个发送事件（GET 请求不适合批量发送）\n      for (const event of events) {\n        try {\n          const response = await this.sendRequest(endpoint, event)\n          \n          if (response.success) {\n            successCount++\n          } else {\n            failedEvents.push(event)\n          }\n        } catch (error) {\n          this.error('事件上报失败:', error)\n          failedEvents.push(event)\n        }\n      }\n\n      if (successCount > 0) {\n        this.log(`成功上报 ${successCount} 个事件`)\n      }\n\n      if (failedEvents.length > 0) {\n        this.log(`失败 ${failedEvents.length} 个事件`)\n        \n        // 保存失败的事件到本地存储等待重试\n        if (this.config.enableStorage) {\n          this.storage.savePendingEvents(failedEvents)\n        }\n      } else {\n        // 全部成功，清除存储\n        if (this.config.enableStorage) {\n          this.storage.clearPendingEvents()\n        }\n      }\n    } catch (error) {\n      this.error('批量上报失败:', error)\n\n      // 保存所有事件到本地存储等待重试\n      if (this.config.enableStorage) {\n        this.storage.savePendingEvents(events)\n      }\n    }\n  }\n\n  /**\n   * 发送单个事件（用于重要事件的即时上报）\n   */\n  public async sendImmediately(event: BaseEvent): Promise<void> {\n    const payload = this.transformToPayload(event)\n    const endpoint = this.getEventEndpoint(event.eventType)\n\n    try {\n      await this.sendRequest(endpoint, payload)\n      this.log('事件即时上报成功:', payload)\n    } catch (error) {\n      this.error('事件即时上报失败:', error)\n      throw error\n    }\n  }\n\n  /**\n   * 获取事件对应的 API 端点\n   */\n  private getEventEndpoint(eventType: string): string {\n    const baseUrl = this.config.apiEndpoint\n\n    switch (eventType) {\n      case EventType.REGISTER:\n        return `${baseUrl}/api/track/register`\n      case EventType.SUBSCRIBE:\n        return `${baseUrl}/api/track/subscribe`\n      case EventType.LOGIN:\n        return `${baseUrl}/api/track/login`\n      default:\n        return `${baseUrl}/api/track/batch`\n    }\n  }\n\n  /**\n   * 发送 HTTP 请求\n   */\n  private async sendRequest(\n    url: string,\n    data: any,\n    retries: number = 0\n  ): Promise<TrackingResponse> {\n    try {\n      const controller = new AbortController()\n      const timeoutId = setTimeout(() => controller.abort(), this.config.timeout)\n\n      // 将数据转换为 URL 参数\n      const params = new URLSearchParams()\n      \n      Object.keys(data).forEach((key) => {\n        const value = data[key]\n        if (value !== undefined && value !== null) {\n          // 将所有值转换为字符串\n          params.append(key, String(value))\n        }\n      })\n\n      const fullUrl = `${url}?${params.toString()}`\n\n      const response = await fetch(fullUrl, {\n        method: 'GET',\n        signal: controller.signal,\n      })\n\n      clearTimeout(timeoutId)\n\n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`)\n      }\n\n      // 尝试解析 JSON 响应，如果失败则返回成功\n      const contentType = response.headers.get('content-type')\n      let result: any = {}\n\n      if (contentType && contentType.includes('application/json')) {\n        const text = await response.text()\n        if (text && text.trim()) {\n          try {\n            result = JSON.parse(text)\n          } catch (e) {\n            this.log(`JSON 解析失败，原始响应: ${text.substring(0, 100)}`)\n            result = { rawResponse: text }\n          }\n        }\n      } else {\n        const text = await response.text()\n        // 对于 GET 请求，空响应也视为成功\n        result = { rawResponse: text || 'OK' }\n      }\n\n      return { success: true, ...result }\n    } catch (error: any) {\n      if (retries < this.config.maxRetries) {\n        this.log(`请求失败，重试 ${retries + 1}/${this.config.maxRetries}`)\n        await this.delay(1000 * Math.pow(2, retries)) // 指数退败\n        return this.sendRequest(url, data, retries + 1)\n      }\n\n      throw error\n    }\n  }\n\n  /**\n   * 手动刷新队列（立即发送所有待发送事件）\n   */\n  public flush(): void {\n    this.eventQueue.flush()\n  }\n\n  /**\n   * 销毁 SDK\n   */\n  public destroy(): void {\n    this.flush()\n    this.eventQueue.destroy()\n    this.isInitialized = false\n    this.log('SDK 已销毁')\n  }\n\n  // ========== 自动采集相关方法 ==========\n\n  /**\n   * 设置点击事件监听器\n   */\n  private setupClickListener(): void {\n    if (typeof document === 'undefined') return\n\n    document.addEventListener(\n      'click',\n      (e: MouseEvent) => {\n        const target = e.target as HTMLElement\n\n        // 获取元素信息\n        const elementId = target.id || target.getAttribute('data-track-id') || ''\n        const elementText = target.textContent?.trim() || ''\n        const elementTag = target.tagName.toLowerCase()\n\n        // 只追踪特定元素或带有 data-track 属性的元素\n        const shouldTrack =\n          target.hasAttribute('data-track') ||\n          elementTag === 'button' ||\n          elementTag === 'a' ||\n          target.classList.contains('trackable')\n\n        if (shouldTrack) {\n          this.trackClick({\n            elementId,\n            elementText: elementText.substring(0, 50), // 限制长度\n            eventData: {\n              elementTag,\n              elementClass: target.className,\n              href: (target as HTMLAnchorElement).href || undefined,\n            },\n          })\n        }\n      },\n      true\n    )\n  }\n\n  /**\n   * 设置页面访问监听器（SPA 路由变化）\n   */\n  private setupPageViewListener(): void {\n    if (typeof window === 'undefined' || typeof history === 'undefined') return\n\n    // 监听 History API\n    const originalPushState = history.pushState\n    const originalReplaceState = history.replaceState\n\n    history.pushState = (...args) => {\n      originalPushState.apply(history, args)\n      this.trackVisit()\n    }\n\n    history.replaceState = (...args) => {\n      originalReplaceState.apply(history, args)\n      this.trackVisit()\n    }\n\n    // 监听 popstate（浏览器前进后退）\n    window.addEventListener('popstate', () => {\n      this.trackVisit()\n    })\n\n    // 监听 hashchange（hash 路由）\n    window.addEventListener('hashchange', () => {\n      this.trackVisit()\n    })\n  }\n\n  /**\n   * 设置页面关闭监听器（确保事件发送完成）\n   */\n  private setupBeforeUnloadListener(): void {\n    if (typeof window === 'undefined' || typeof document === 'undefined') return\n\n    window.addEventListener('beforeunload', () => {\n      this.flush()\n    })\n\n    // 使用 visibilitychange 处理移动端场景\n    document.addEventListener('visibilitychange', () => {\n      if (document.visibilityState === 'hidden') {\n        this.flush()\n      }\n    })\n  }\n\n  // ========== 工具方法 ==========\n\n  /**\n   * 生成会话 ID\n   */\n  private generateSessionId(): string {\n    return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`\n  }\n\n  /**\n   * 延迟函数\n   */\n  private delay(ms: number): Promise<void> {\n    return new Promise((resolve) => setTimeout(resolve, ms))\n  }\n\n  /**\n   * 日志输出\n   */\n  private log(...args: any[]): void {\n    if (this.config.debug) {\n      console.log('[TrackingSDK]', ...args)\n    }\n  }\n\n  /**\n   * 错误日志\n   */\n  private error(...args: any[]): void {\n    if (this.config.debug) {\n      console.error('[TrackingSDK]', ...args)\n    }\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACMO,IAAK,YAAL,kBAAKA,eAAL;AAEL,EAAAA,WAAA,cAAW;AAEX,EAAAA,WAAA,eAAY;AAEZ,EAAAA,WAAA,WAAQ;AAER,EAAAA,WAAA,YAAS;AAET,EAAAA,WAAA,WAAQ;AAER,EAAAA,WAAA,WAAQ;AAER,EAAAA,WAAA,YAAS;AAdC,SAAAA;AAAA,GAAA;;;ACOL,IAAM,cAAN,MAAM,YAAW;AAAA,EAKtB,YAAY,QAA0B;AAJtC,SAAQ,QAAgC,CAAC;AAEzC,SAAQ,aAAmD;AAGzD,SAAK,SAAS;AACd,SAAK,gBAAgB;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA,EAKO,KAAK,OAAmC;AAC7C,SAAK,MAAM,KAAK,KAAK;AAGrB,QAAI,KAAK,MAAM,UAAU,KAAK,OAAO,WAAW;AAC9C,WAAK,MAAM;AAAA,IACb;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKO,QAAc;AACnB,QAAI,KAAK,MAAM,WAAW,EAAG;AAE7B,UAAM,eAAe,CAAC,GAAG,KAAK,KAAK;AACnC,SAAK,QAAQ,CAAC;AAGd,SAAK,gBAAgB;AAGrB,SAAK,OAAO,QAAQ,YAAY,EAAE,MAAM,CAAC,UAAU;AACjD,cAAQ,MAAM,0CAAsB,KAAK;AAEzC,WAAK,MAAM,QAAQ,GAAG,YAAY;AAAA,IACpC,CAAC;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKO,SAAiC;AACtC,WAAO,CAAC,GAAG,KAAK,KAAK;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA,EAKO,QAAc;AACnB,SAAK,QAAQ,CAAC;AAAA,EAChB;AAAA;AAAA;AAAA;AAAA,EAKO,UAAgB;AACrB,SAAK,MAAM;AACX,SAAK,eAAe;AAAA,EACtB;AAAA;AAAA;AAAA;AAAA,EAKQ,kBAAwB;AAC9B,SAAK,aAAa,YAAY,MAAM;AAClC,WAAK,MAAM;AAAA,IACb,GAAG,KAAK,OAAO,aAAa;AAAA,EAC9B;AAAA;AAAA;AAAA;AAAA,EAKQ,kBAAwB;AAC9B,SAAK,eAAe;AACpB,SAAK,gBAAgB;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA,EAKQ,iBAAuB;AAC7B,QAAI,KAAK,YAAY;AACnB,oBAAc,KAAK,UAAU;AAC7B,WAAK,aAAa;AAAA,IACpB;AAAA,EACF;AACF;AA1FwB;AAAjB,IAAM,aAAN;;;ACNA,IAAM,kBAAN,MAAM,gBAAe;AAAA,EAG1B,YAAY,SAAiB,iBAAiB;AAC5C,SAAK,SAAS;AAAA,EAChB;AAAA;AAAA;AAAA;AAAA,EAKO,UAAU,QAAsB;AACrC,SAAK,QAAQ,WAAW,MAAM;AAAA,EAChC;AAAA;AAAA;AAAA;AAAA,EAKO,YAA2B;AAChC,WAAO,KAAK,QAAQ,SAAS;AAAA,EAC/B;AAAA;AAAA;AAAA;AAAA,EAKO,cAAoB;AACzB,SAAK,WAAW,SAAS;AAAA,EAC3B;AAAA;AAAA;AAAA;AAAA,EAKO,kBAAkB,QAAsC;AAC7D,SAAK,QAAQ,kBAAkB,KAAK,UAAU,MAAM,CAAC;AAAA,EACvD;AAAA;AAAA;AAAA;AAAA,EAKO,mBAA2C;AAChD,UAAM,OAAO,KAAK,QAAQ,gBAAgB;AAC1C,QAAI,CAAC,KAAM,QAAO,CAAC;AAEnB,QAAI;AACF,aAAO,KAAK,MAAM,IAAI;AAAA,IACxB,QAAQ;AACN,aAAO,CAAC;AAAA,IACV;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKO,qBAA2B;AAChC,SAAK,WAAW,gBAAgB;AAAA,EAClC;AAAA;AAAA,EAIQ,QAAQ,KAAa,OAAqB;AAChD,QAAI;AACF,mBAAa,QAAQ,KAAK,SAAS,KAAK,KAAK;AAAA,IAC/C,SAAS,OAAO;AACd,cAAQ,MAAM,8CAA0B,KAAK;AAAA,IAC/C;AAAA,EACF;AAAA,EAEQ,QAAQ,KAA4B;AAC1C,QAAI;AACF,aAAO,aAAa,QAAQ,KAAK,SAAS,GAAG;AAAA,IAC/C,SAAS,OAAO;AACd,cAAQ,MAAM,8CAA0B,KAAK;AAC7C,aAAO;AAAA,IACT;AAAA,EACF;AAAA,EAEQ,WAAW,KAAmB;AACpC,QAAI;AACF,mBAAa,WAAW,KAAK,SAAS,GAAG;AAAA,IAC3C,SAAS,OAAO;AACd,cAAQ,MAAM,8CAA0B,KAAK;AAAA,IAC/C;AAAA,EACF;AACF;AAlF4B;AAArB,IAAM,iBAAN;;;ACiBA,IAAM,eAAN,MAAM,aAAY;AAAA,EAQvB,YAAY,QAAwB;AAJpC,SAAQ,gBAA+B;AAEvC,SAAQ,gBAAyB;AAI/B,SAAK,SAAS;AAAA,MACZ,aAAa,OAAO;AAAA,MACpB,YACE,OAAO,eAAe,OAAO,WAAW,cAAc,OAAO,SAAS,WAAW;AAAA,MACnF,OAAO,OAAO,SAAS;AAAA,MACvB,WAAW,OAAO,aAAa;AAAA,MAC/B,eAAe,OAAO,iBAAiB;AAAA,MACvC,cAAc,OAAO,gBAAgB;AAAA,MACrC,WAAW,OAAO,aAAa;AAAA,MAC/B,SAAS,OAAO,WAAW;AAAA,MAC3B,YAAY,OAAO,cAAc;AAAA,MACjC,eAAe,OAAO,iBAAiB;AAAA,MACvC,eAAe,OAAO,iBAAiB;AAAA,IACzC;AAGA,SAAK,UAAU,IAAI,eAAe,KAAK,OAAO,aAAa;AAC3D,SAAK,aAAa,IAAI,WAAW;AAAA,MAC/B,WAAW,KAAK,OAAO;AAAA,MACvB,eAAe,KAAK,OAAO;AAAA,MAC3B,SAAS,KAAK,UAAU,KAAK,IAAI;AAAA,IACnC,CAAC;AAGD,SAAK,YAAY,KAAK,kBAAkB;AAExC,SAAK,IAAI,kCAAmB,KAAK,MAAM;AAAA,EACzC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAa,OAAsB;AACjC,QAAI,KAAK,eAAe;AACtB,WAAK,IAAI,8BAAU;AACnB;AAAA,IACF;AAGA,QAAI,KAAK,OAAO,eAAe;AAC7B,WAAK,gBAAgB,KAAK,QAAQ,UAAU;AAE5C,YAAM,gBAAgB,KAAK,QAAQ,iBAAiB;AACpD,UAAI,cAAc,SAAS,GAAG;AAC5B,aAAK,IAAI,gBAAM,cAAc,MAAM,uCAAS;AAC5C,sBAAc,QAAQ,CAAC,UAAU,KAAK,WAAW,KAAK,KAAK,CAAC;AAAA,MAC9D;AAAA,IACF;AAGA,QAAI,KAAK,OAAO,cAAc;AAC5B,WAAK,WAAW;AAChB,WAAK,sBAAsB;AAAA,IAC7B;AAGA,QAAI,KAAK,OAAO,WAAW;AACzB,WAAK,mBAAmB;AAAA,IAC1B;AAGA,SAAK,0BAA0B;AAE/B,SAAK,gBAAgB;AACrB,SAAK,IAAI,oCAAW;AAAA,EACtB;AAAA;AAAA;AAAA;AAAA,EAKO,UAAU,QAAsB;AACrC,SAAK,gBAAgB;AACrB,QAAI,KAAK,OAAO,eAAe;AAC7B,WAAK,QAAQ,UAAU,MAAM;AAAA,IAC/B;AACA,SAAK,IAAI,uCAAc,MAAM;AAAA,EAC/B;AAAA;AAAA;AAAA;AAAA,EAKO,cAAoB;AACzB,SAAK,gBAAgB;AACrB,QAAI,KAAK,OAAO,eAAe;AAC7B,WAAK,QAAQ,YAAY;AAAA,IAC3B;AACA,SAAK,IAAI,oCAAW;AAAA,EACtB;AAAA;AAAA;AAAA;AAAA,EAKO,cAAc,OAA+B,CAAC,GAAS;AAC5D,UAAM,QAAmB;AAAA,MACvB;AAAA,MACA,KAAK,KAAK,OAAO,KAAK,iBAAiB;AAAA,MACvC,QAAQ,KAAK,UAAU;AAAA,MACvB,WAAW;AAAA,QACT,QAAQ,KAAK;AAAA,QACb,GAAG,KAAK;AAAA,MACV;AAAA,IACF;AAEA,SAAK,MAAM,KAAK;AAAA,EAClB;AAAA;AAAA;AAAA;AAAA,EAKO,eAAe,MAAqC;AACzD,UAAM,QAAmB;AAAA,MACvB;AAAA,MACA,KAAK,KAAK,OAAO,KAAK,iBAAiB;AAAA,MACvC,QAAQ,KAAK,UAAU;AAAA,MACvB,WAAW;AAAA,QACT,MAAM,KAAK;AAAA,QACX,UAAU,KAAK;AAAA,QACf,QAAQ,KAAK;AAAA,QACb,GAAG,KAAK;AAAA,MACV;AAAA,IACF;AAEA,SAAK,MAAM,KAAK;AAAA,EAClB;AAAA;AAAA;AAAA;AAAA,EAKO,WAAW,OAA4B,CAAC,GAAS;AACtD,UAAM,QAAmB;AAAA,MACvB;AAAA,MACA,KAAK,KAAK,OAAO,KAAK,iBAAiB;AAAA,MACvC,QAAQ,KAAK,UAAU;AAAA,MACvB,WAAW;AAAA,QACT,aAAa,KAAK;AAAA,QAClB,GAAG,KAAK;AAAA,MACV;AAAA,IACF;AAEA,SAAK,MAAM,KAAK;AAAA,EAClB;AAAA;AAAA;AAAA;AAAA,EAKO,cAAoB;AACzB,UAAM,QAAmB;AAAA,MACvB;AAAA,MACA,KAAK,KAAK,iBAAiB;AAAA,MAC3B,QAAQ;AAAA,IACV;AAEA,SAAK,MAAM,KAAK;AAChB,SAAK,YAAY;AAAA,EACnB;AAAA;AAAA;AAAA;AAAA,EAKO,WAAW,MAAe,OAAsB;AACrD,UAAM,QAAmB;AAAA,MACvB;AAAA,MACA,KAAK,KAAK,iBAAiB;AAAA,MAC3B,QAAQ;AAAA,MACR,WAAW;AAAA,QACT,MAAM,SAAS,OAAO,WAAW,cAAc,OAAO,SAAS,WAAW;AAAA,QAC1E,OAAO,UAAU,OAAO,aAAa,cAAc,SAAS,QAAQ;AAAA,MACtE;AAAA,IACF;AAEA,SAAK,MAAM,KAAK;AAAA,EAClB;AAAA;AAAA;AAAA;AAAA,EAKO,cAAc,MAAe,OAAsB;AACxD,SAAK,WAAW,MAAM,KAAK;AAAA,EAC7B;AAAA;AAAA;AAAA;AAAA,EAKO,WAAW,MAA0C;AAC1D,QAAI;AAEJ,QAAI,OAAO,SAAS,UAAU;AAE5B,cAAQ;AAAA,QACN;AAAA,QACA,KAAK,KAAK,iBAAiB;AAAA,QAC3B,QAAQ;AAAA,QACR,WAAW;AAAA,UACT,WAAW;AAAA,QACb;AAAA,MACF;AAAA,IACF,OAAO;AAEL,cAAQ;AAAA,QACN;AAAA,QACA,KAAK,KAAK,OAAO,KAAK,iBAAiB;AAAA,QACvC,QAAQ,KAAK,UAAU;AAAA,QACvB,WAAW;AAAA,UACT,WAAW,KAAK;AAAA,UAChB,aAAa,KAAK;AAAA,UAClB,GAAG,KAAK;AAAA,QACV;AAAA,MACF;AAAA,IACF;AAEA,SAAK,MAAM,KAAK;AAAA,EAClB;AAAA;AAAA;AAAA;AAAA,EAKO,YAAY,WAAmB,OAA4B,CAAC,GAAS;AAC1E,UAAM,QAAmB;AAAA,MACvB,WAAW;AAAA,MACX,KAAK,KAAK,iBAAiB;AAAA,MAC3B,QAAQ,KAAK,UAAU;AAAA,MACvB,WAAW;AAAA,IACb;AAEA,SAAK,MAAM,KAAK;AAAA,EAClB;AAAA;AAAA;AAAA;AAAA,EAKQ,MAAM,OAAwB;AAEpC,UAAM,UAAU,KAAK,mBAAmB,KAAK;AAG7C,SAAK,WAAW,KAAK,OAAO;AAG5B,QAAI,KAAK,OAAO,eAAe;AAC7B,WAAK,QAAQ,kBAAkB,KAAK,WAAW,OAAO,CAAC;AAAA,IACzD;AAEA,SAAK,IAAI,mCAAU,OAAO;AAAA,EAC5B;AAAA;AAAA;AAAA;AAAA;AAAA,EAMQ,mBAAmB,OAAwC;AACjE,UAAM,oBAAoB,OAAO,WAAW;AAC5C,UAAM,sBAAsB,OAAO,aAAa;AAChD,UAAM,uBAAuB,OAAO,cAAc;AAElD,UAAM,UAAgC;AAAA;AAAA,MAEpC,WAAW,MAAM;AAAA,MACjB,YAAY,KAAK,OAAO;AAAA,MACxB,OAAO,MAAM;AAAA,MACb,WAAW,MAAM;AAAA,MACjB,WAAW,KAAK,IAAI;AAAA,MACpB,KAAK,oBAAoB,OAAO,SAAS,WAAW,OAAO,SAAS,SAAS;AAAA,MAC7E,SAAS,sBAAsB,SAAS,YAAY,SAAY;AAAA,MAChE,WAAW,uBAAuB,UAAU,YAAY;AAAA,MACxD,WAAW,KAAK;AAAA,IAClB;AAGA,QAAI,qBAAqB,sBAAsB;AAC7C,cAAQ,MAAM,OAAO,SAAS;AAC9B,cAAQ,mBAAmB,GAAG,OAAO,OAAO,KAAK,IAAI,OAAO,OAAO,MAAM;AACzE,cAAQ,WAAW,GAAG,OAAO,UAAU,IAAI,OAAO,WAAW;AAC7D,cAAQ,WAAW,UAAU;AAC7B,cAAQ,WAAW,KAAK,eAAe,EAAE,gBAAgB,EAAE;AAC3D,cAAQ,WAAW,UAAU;AAAA,IAC/B;AAGA,QAAI,MAAM,WAAW;AACnB,aAAO,OAAO,SAAS,MAAM,SAAS;AAAA,IACxC;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,UAAU,QAA+C;AACrE,QAAI,OAAO,WAAW,EAAG;AAEzB,UAAM,WAAW,GAAG,KAAK,OAAO,WAAW;AAC3C,QAAI,eAAe;AACnB,UAAM,eAAuC,CAAC;AAE9C,QAAI;AAEF,iBAAW,SAAS,QAAQ;AAC1B,YAAI;AACF,gBAAM,WAAW,MAAM,KAAK,YAAY,UAAU,KAAK;AAEvD,cAAI,SAAS,SAAS;AACpB;AAAA,UACF,OAAO;AACL,yBAAa,KAAK,KAAK;AAAA,UACzB;AAAA,QACF,SAAS,OAAO;AACd,eAAK,MAAM,yCAAW,KAAK;AAC3B,uBAAa,KAAK,KAAK;AAAA,QACzB;AAAA,MACF;AAEA,UAAI,eAAe,GAAG;AACpB,aAAK,IAAI,4BAAQ,YAAY,qBAAM;AAAA,MACrC;AAEA,UAAI,aAAa,SAAS,GAAG;AAC3B,aAAK,IAAI,gBAAM,aAAa,MAAM,qBAAM;AAGxC,YAAI,KAAK,OAAO,eAAe;AAC7B,eAAK,QAAQ,kBAAkB,YAAY;AAAA,QAC7C;AAAA,MACF,OAAO;AAEL,YAAI,KAAK,OAAO,eAAe;AAC7B,eAAK,QAAQ,mBAAmB;AAAA,QAClC;AAAA,MACF;AAAA,IACF,SAAS,OAAO;AACd,WAAK,MAAM,yCAAW,KAAK;AAG3B,UAAI,KAAK,OAAO,eAAe;AAC7B,aAAK,QAAQ,kBAAkB,MAAM;AAAA,MACvC;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAa,gBAAgB,OAAiC;AAC5D,UAAM,UAAU,KAAK,mBAAmB,KAAK;AAC7C,UAAM,WAAW,KAAK,iBAAiB,MAAM,SAAS;AAEtD,QAAI;AACF,YAAM,KAAK,YAAY,UAAU,OAAO;AACxC,WAAK,IAAI,qDAAa,OAAO;AAAA,IAC/B,SAAS,OAAO;AACd,WAAK,MAAM,qDAAa,KAAK;AAC7B,YAAM;AAAA,IACR;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,iBAAiB,WAA2B;AAClD,UAAM,UAAU,KAAK,OAAO;AAE5B,YAAQ,WAAW;AAAA,MACjB;AACE,eAAO,GAAG,OAAO;AAAA,MACnB;AACE,eAAO,GAAG,OAAO;AAAA,MACnB;AACE,eAAO,GAAG,OAAO;AAAA,MACnB;AACE,eAAO,GAAG,OAAO;AAAA,IACrB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,YACZ,KACA,MACA,UAAkB,GACS;AAC3B,QAAI;AACF,YAAM,aAAa,IAAI,gBAAgB;AACvC,YAAM,YAAY,WAAW,MAAM,WAAW,MAAM,GAAG,KAAK,OAAO,OAAO;AAG1E,YAAM,SAAS,IAAI,gBAAgB;AAEnC,aAAO,KAAK,IAAI,EAAE,QAAQ,CAAC,QAAQ;AACjC,cAAM,QAAQ,KAAK,GAAG;AACtB,YAAI,UAAU,UAAa,UAAU,MAAM;AAEzC,iBAAO,OAAO,KAAK,OAAO,KAAK,CAAC;AAAA,QAClC;AAAA,MACF,CAAC;AAED,YAAM,UAAU,GAAG,GAAG,IAAI,OAAO,SAAS,CAAC;AAE3C,YAAM,WAAW,MAAM,MAAM,SAAS;AAAA,QACpC,QAAQ;AAAA,QACR,QAAQ,WAAW;AAAA,MACrB,CAAC;AAED,mBAAa,SAAS;AAEtB,UAAI,CAAC,SAAS,IAAI;AAChB,cAAM,IAAI,MAAM,QAAQ,SAAS,MAAM,KAAK,SAAS,UAAU,EAAE;AAAA,MACnE;AAGA,YAAM,cAAc,SAAS,QAAQ,IAAI,cAAc;AACvD,UAAI,SAAc,CAAC;AAEnB,UAAI,eAAe,YAAY,SAAS,kBAAkB,GAAG;AAC3D,cAAM,OAAO,MAAM,SAAS,KAAK;AACjC,YAAI,QAAQ,KAAK,KAAK,GAAG;AACvB,cAAI;AACF,qBAAS,KAAK,MAAM,IAAI;AAAA,UAC1B,SAAS,GAAG;AACV,iBAAK,IAAI,gEAAmB,KAAK,UAAU,GAAG,GAAG,CAAC,EAAE;AACpD,qBAAS,EAAE,aAAa,KAAK;AAAA,UAC/B;AAAA,QACF;AAAA,MACF,OAAO;AACL,cAAM,OAAO,MAAM,SAAS,KAAK;AAEjC,iBAAS,EAAE,aAAa,QAAQ,KAAK;AAAA,MACvC;AAEA,aAAO,EAAE,SAAS,MAAM,GAAG,OAAO;AAAA,IACpC,SAAS,OAAY;AACnB,UAAI,UAAU,KAAK,OAAO,YAAY;AACpC,aAAK,IAAI,8CAAW,UAAU,CAAC,IAAI,KAAK,OAAO,UAAU,EAAE;AAC3D,cAAM,KAAK,MAAM,MAAO,KAAK,IAAI,GAAG,OAAO,CAAC;AAC5C,eAAO,KAAK,YAAY,KAAK,MAAM,UAAU,CAAC;AAAA,MAChD;AAEA,YAAM;AAAA,IACR;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKO,QAAc;AACnB,SAAK,WAAW,MAAM;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA,EAKO,UAAgB;AACrB,SAAK,MAAM;AACX,SAAK,WAAW,QAAQ;AACxB,SAAK,gBAAgB;AACrB,SAAK,IAAI,wBAAS;AAAA,EACpB;AAAA;AAAA;AAAA;AAAA;AAAA,EAOQ,qBAA2B;AACjC,QAAI,OAAO,aAAa,YAAa;AAErC,aAAS;AAAA,MACP;AAAA,MACA,CAAC,MAAkB;AACjB,cAAM,SAAS,EAAE;AAGjB,cAAM,YAAY,OAAO,MAAM,OAAO,aAAa,eAAe,KAAK;AACvE,cAAM,cAAc,OAAO,aAAa,KAAK,KAAK;AAClD,cAAM,aAAa,OAAO,QAAQ,YAAY;AAG9C,cAAM,cACJ,OAAO,aAAa,YAAY,KAChC,eAAe,YACf,eAAe,OACf,OAAO,UAAU,SAAS,WAAW;AAEvC,YAAI,aAAa;AACf,eAAK,WAAW;AAAA,YACd;AAAA,YACA,aAAa,YAAY,UAAU,GAAG,EAAE;AAAA;AAAA,YACxC,WAAW;AAAA,cACT;AAAA,cACA,cAAc,OAAO;AAAA,cACrB,MAAO,OAA6B,QAAQ;AAAA,YAC9C;AAAA,UACF,CAAC;AAAA,QACH;AAAA,MACF;AAAA,MACA;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,wBAA8B;AACpC,QAAI,OAAO,WAAW,eAAe,OAAO,YAAY,YAAa;AAGrE,UAAM,oBAAoB,QAAQ;AAClC,UAAM,uBAAuB,QAAQ;AAErC,YAAQ,YAAY,IAAI,SAAS;AAC/B,wBAAkB,MAAM,SAAS,IAAI;AACrC,WAAK,WAAW;AAAA,IAClB;AAEA,YAAQ,eAAe,IAAI,SAAS;AAClC,2BAAqB,MAAM,SAAS,IAAI;AACxC,WAAK,WAAW;AAAA,IAClB;AAGA,WAAO,iBAAiB,YAAY,MAAM;AACxC,WAAK,WAAW;AAAA,IAClB,CAAC;AAGD,WAAO,iBAAiB,cAAc,MAAM;AAC1C,WAAK,WAAW;AAAA,IAClB,CAAC;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKQ,4BAAkC;AACxC,QAAI,OAAO,WAAW,eAAe,OAAO,aAAa,YAAa;AAEtE,WAAO,iBAAiB,gBAAgB,MAAM;AAC5C,WAAK,MAAM;AAAA,IACb,CAAC;AAGD,aAAS,iBAAiB,oBAAoB,MAAM;AAClD,UAAI,SAAS,oBAAoB,UAAU;AACzC,aAAK,MAAM;AAAA,MACb;AAAA,IACF,CAAC;AAAA,EACH;AAAA;AAAA;AAAA;AAAA;AAAA,EAOQ,oBAA4B;AAClC,WAAO,GAAG,KAAK,IAAI,CAAC,IAAI,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,OAAO,GAAG,CAAC,CAAC;AAAA,EACjE;AAAA;AAAA;AAAA;AAAA,EAKQ,MAAM,IAA2B;AACvC,WAAO,IAAI,QAAQ,CAAC,YAAY,WAAW,SAAS,EAAE,CAAC;AAAA,EACzD;AAAA;AAAA;AAAA;AAAA,EAKQ,OAAO,MAAmB;AAChC,QAAI,KAAK,OAAO,OAAO;AACrB,cAAQ,IAAI,iBAAiB,GAAG,IAAI;AAAA,IACtC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,SAAS,MAAmB;AAClC,QAAI,KAAK,OAAO,OAAO;AACrB,cAAQ,MAAM,iBAAiB,GAAG,IAAI;AAAA,IACxC;AAAA,EACF;AACF;AA/kByB;AAAlB,IAAM,cAAN;","names":["EventType"]}